<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OAuth Popup Simulation</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>OAuth Login Simulation</h1>
  <button id="oauth-button">Login with Demo OAuth</button>

  <script>
    document.getElementById("oauth-button").addEventListener("click", openOAuthPopup);

    function openOAuthPopup() {
      const popup = window.open('', 'OAuthLogin', 'width=500,height=600,left=200,top=100');

      if (!popup) {
        alert("Popup blocked! Please allow popups for this site.");
        return;
      }

      const popupContent = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='UTF-8'>
  <title>OAuth Provider</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Demo OAuth Login</h2>
  <p>This popup simulates an OAuth provider login page.</p>
  <button id='authorize'>Authorize</button>
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      document.getElementById('authorize').addEventListener('click', function () {
        window.location.href = 'https://danielarrais-tr.github.io/cases-demo/redirect.html#access_token=demo-token-123';
      });
    });
  <\/script>
</body>
</html>`;

      popup.document.open();
      popup.document.write(popupContent);
      popup.document.close();

      const pollTimer = setInterval(() => {
        try {
          const href = popup.location.href;
          if (href.includes("access_token")) {
            const token = new URL(href).hash.split("access_token=")[1];
            console.log("âœ… Access token received:", token);
            popup.close();
            clearInterval(pollTimer);
          }
        } catch (e) {
          // Ignore cross-origin errors
        }

        if (popup.closed) {
          console.warn("Popup closed before authentication completed");
          clearInterval(pollTimer);
        }
      }, 300);
    }
  </script>
</body>
</html>
