<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Menu Multi‑nível no Hover (Bootstrap 5, sem jQuery)</title>
  <!-- Bootstrap 5 (bundle inclui Popper) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    /* ===== Estilos do menu multi‑nível ===== */
    .dropdown-submenu { position: relative; }

    /* Submenu abre ao lado no desktop */
    .dropdown-menu .dropdown-submenu > .dropdown-menu {
      top: 0;
      left: 100%;
      margin-left: .1rem;
      margin-right: .1rem;
    }

    /* Ícone setinha opcional */
    .dropdown-toggle::after { margin-left: .4rem; }
    .submenu-caret::after { content: "›"; margin-left: .5rem; font-weight: 700; }

    /* Hover apenas em telas grandes (evitar conflito com toque no mobile) */
    @media (min-width: 992px) {
      .dropdown:hover > .dropdown-menu { display: block; }
      .dropdown-submenu:hover > .dropdown-menu { display: block; }

      /* Melhora a experiência de hover: mantém aberto enquanto o mouse estiver sobre o menu */
      .dropdown-menu { margin-top: 0; }
    }

    /* Pequena sombra e bordas arredondadas para destacar submenus */
    .dropdown-menu { box-shadow: 0 10px 20px rgba(0,0,0,.08); border-radius: .5rem; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom sticky-top">
  <div class="container">
    <a class="navbar-brand fw-semibold" href="#">Minha Página</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Alternar navegação">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="#">Início</a></li>

        <!-- Nível 1: dropdown padrão -->
        <li class="nav-item dropdown" data-hover="true">
          <a class="nav-link dropdown-toggle" href="#" id="menuProdutos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Produtos
          </a>
          <ul class="dropdown-menu" aria-labelledby="menuProdutos">
            <li><a class="dropdown-item" href="#">Lançamentos</a></li>
            <li><a class="dropdown-item" href="#">Mais vendidos</a></li>
            <li><hr class="dropdown-divider"></li>

            <!-- Nível 2: submenu -->
            <li class="dropdown-submenu" data-hover="true">
              <a class="dropdown-item d-flex justify-content-between align-items-center submenu-caret" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Smartphones
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Android</a></li>
                <li><a class="dropdown-item" href="#">iOS</a></li>

                <!-- Nível 3: submenu dentro do submenu -->
                <li class="dropdown-submenu" data-hover="true">
                  <a class="dropdown-item d-flex justify-content-between align-items-center submenu-caret" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Acessórios
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Capas</a></li>
                    <li><a class="dropdown-item" href="#">Películas</a></li>
                    <li><a class="dropdown-item" href="#">Carregadores</a></li>
                  </ul>
                </li>
              </ul>
            </li>

            <li class="dropdown-submenu" data-hover="true">
              <a class="dropdown-item d-flex justify-content-between align-items-center submenu-caret" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Notebooks
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Ultrabooks</a></li>
                <li><a class="dropdown-item" href="#">Gamers</a></li>
                <li><a class="dropdown-item" href="#">2‑em‑1</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li class="nav-item dropdown" data-hover="true">
          <a class="nav-link dropdown-toggle" href="#" id="menuServicos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Serviços
          </a>
          <ul class="dropdown-menu" aria-labelledby="menuServicos">
            <li><a class="dropdown-item" href="#">Suporte</a></li>
            <li><a class="dropdown-item" href="#">Garantia estendida</a></li>
            <li><a class="dropdown-item" href="#">Consultoria</a></li>
          </ul>
        </li>

        <li class="nav-item"><a class="nav-link" href="#">Contato</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container py-5">
  <h1 class="display-6">Exemplo de Menu Multi‑nível no Hover</h1>
  <p class="lead">Funciona sem jQuery. No desktop abre por <strong>hover</strong>; no mobile continua por <strong>toque</strong> (comportamento padrão do Bootstrap).</p>
  <p>Este exemplo também cuida de acessibilidade (ARIA), foco por teclado e fechamento automático ao sair com o mouse.</p>
</main>

<script>
  // ===== Comportamento no hover apenas em telas >= lg (min-width 992px) =====
  (function () {
    const matchLg = window.matchMedia('(min-width: 992px)');

    function bindHoverMenus() {
      // Para cada dropdown/submenu marcado com data-hover
      document.querySelectorAll('.dropdown[data-hover], .dropdown-submenu[data-hover]').forEach(el => {
        const toggle = el.querySelector('[data-bs-toggle="dropdown"]');
        const menu   = el.querySelector(':scope > .dropdown-menu');
        if (!toggle || !menu) return;

        // Limpamos listeners antigos (se rebind)
        el._hoverBound && el._hoverBound.forEach(off => off());
        el._hoverBound = [];

        if (matchLg.matches) {
          // Desktop: abrir/fechar via mouseenter/mouseleave
          const show = () => { menu.classList.add('show'); toggle.setAttribute('aria-expanded', 'true'); };
          const hide = () => { menu.classList.remove('show'); toggle.setAttribute('aria-expanded', 'false'); };

          let hideTimer;
          const onEnter = () => { clearTimeout(hideTimer); show(); };
          const onLeave = () => { hideTimer = setTimeout(hide, 150); };

          el.addEventListener('mouseenter', onEnter);
          el.addEventListener('mouseleave', onLeave);
          el._hoverBound.push(() => el.removeEventListener('mouseenter', onEnter));
          el._hoverBound.push(() => el.removeEventListener('mouseleave', onLeave));

          // Acessibilidade por teclado: abre no foco e fecha ao sair
          toggle.addEventListener('focusin', show);
          menu.addEventListener('focusout', (e) => {
            if (!el.contains(e.relatedTarget)) hide();
          });
          el._hoverBound.push(() => toggle.removeEventListener('focusin', show));
          // Não há removeEventListener fácil para focusout em função anônima; ok para demo.

          // Evita que o clique no toggle feche imediatamente no desktop
          toggle.addEventListener('click', (ev) => { ev.preventDefault(); show(); });
          el._hoverBound.push(() => toggle.removeEventListener('click', () => {}));
        } else {
          // Mobile: garantir que clássicos data-bs-toggle funcionem (sem hover)
          // Remover "show" forçado se vier de um resize
          menu.classList.remove('show');
          toggle.setAttribute('aria-expanded', 'false');
        }
      });
    }

    bindHoverMenus();
    matchLg.addEventListener('change', bindHoverMenus);

    // Fecha dropdowns ao clicar fora (desktop) – útil para submenus também
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown, .dropdown-submenu')) {
        document.querySelectorAll('.dropdown-menu.show').forEach(m => {
          m.classList.remove('show');
          const parentToggle = m.parentElement?.querySelector('[data-bs-toggle="dropdown"]');
          if (parentToggle) parentToggle.setAttribute('aria-expanded', 'false');
        });
      }
    });
  })();
</script>
</body>
</html>
